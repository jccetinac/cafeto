{"ast":null,"code":"var _jsxFileName = \"/Users/admin/Desktop/cafeto/client/src/components/movie.js\";\nimport React, { Component } from 'react';\nimport { Link } from 'react-router-dom';\nimport StarRatings from 'react-star-ratings';\n\nclass Movie extends Component {\n  constructor() {\n    super();\n    this.fetchRating = this.fetchRating.bind(this);\n    this.changeRating = this.changeRating.bind(this);\n    this.addRatingMovie = this.addRatingMovie.bind(this);\n    this.state = {\n      _id: '',\n      rating: 1,\n      idmovie: ''\n    };\n  }\n\n  componentDidMount() {\n    this.fetchRating();\n  }\n\n  fetchRating() {\n    const IDMOVIE = this.props.id;\n    const EMAIL = this.props.useremail;\n    fetch('/api/movie/').then(res => res.json()).then(data => {\n      const myRate = data.filter(function (element) {\n        return parseInt(element.idmovie, 10) === IDMOVIE && element.email === EMAIL;\n      });\n      const newRate = myRate[0];\n      console.log(myRate === undefined || myRate.length == 0);\n\n      if (!myRate === undefined || !myRate.length == 0) {\n        this.setState({\n          _id: newRate._id,\n          rating: newRate.rating,\n          idmovie: newRate.idmovie\n        });\n      } else {\n        this.setState({\n          _id: '',\n          rating: 0,\n          idmovie: this.props.idmovie\n        });\n      }\n\n      console.log(this.state._id);\n    });\n  }\n\n  changeRating(newRating) {\n    console.log(newRating);\n    this.setState({\n      rating: newRating,\n      idmovie: this.props.id\n    });\n    console.log(this.state._id);\n    this.addRatingMovie(newRating);\n  }\n\n  addRatingMovie(rat) {\n    console.log(rat);\n    console.log(this.state._id);\n    const IDMOVIE = this.props.id;\n\n    if (this.state._id === '' || this.state._id === undefined) {\n      fetch('/api/movie', {\n        method: 'POST',\n        body: JSON.stringify({\n          id: this.state._id,\n          rating: rat,\n          idmovie: IDMOVIE\n        }),\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        }\n      }).then(res => res.json()).then(data => {\n        console.log(data);\n        this.fetchRating();\n      });\n    } else {\n      fetch(\"/api/movie/\".concat(this.state._id), {\n        method: 'PUT',\n        body: JSON.stringify({\n          id: this.state._id,\n          rating: rat,\n          idmovie: this.state.idmovie\n        }),\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        }\n      }).then(res => res.json()).then(data => {\n        console.log(data);\n        this.fetchRating();\n      });\n    }\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      key: this.props.id,\n      className: \"col-md-12\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"card p-3\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"row\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"col-md-4\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      className: \"card-img-top mb-2\",\n      src: this.props.picture,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      className: \"col-md-8\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"card-body\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124\n      },\n      __self: this\n    }, React.createElement(\"h4\", {\n      className: \"card-title\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125\n      },\n      __self: this\n    }, this.props.title), React.createElement(\"h2\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126\n      },\n      __self: this\n    }, this.props.useremail), React.createElement(StarRatings, {\n      rating: this.state.rating,\n      starRatedColor: \"gold\",\n      changeRating: this.changeRating,\n      numberOfStars: 5,\n      name: \"rating\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128\n      },\n      __self: this\n    }), React.createElement(\"p\", {\n      className: \"card-text mt-3 text-justify\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135\n      },\n      __self: this\n    }, this.props.description), this.props.place === 'home' ? React.createElement(Link, {\n      className: \"btn btn-block btn-outline-info\",\n      to: \"movie/\".concat(this.props.id),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136\n      },\n      __self: this\n    }, \"ver m\\xE1s\") : React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137\n      },\n      __self: this\n    }))))));\n  }\n\n}\n\nexport default Movie;","map":{"version":3,"sources":["/Users/admin/Desktop/cafeto/client/src/components/movie.js"],"names":["React","Component","Link","StarRatings","Movie","constructor","fetchRating","bind","changeRating","addRatingMovie","state","_id","rating","idmovie","componentDidMount","IDMOVIE","props","id","EMAIL","useremail","fetch","then","res","json","data","myRate","filter","element","parseInt","email","newRate","console","log","undefined","length","setState","newRating","rat","method","body","JSON","stringify","headers","render","picture","title","description","place"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAAQC,IAAR,QAAmB,kBAAnB;AACA,OAAOC,WAAP,MAAwB,oBAAxB;;AAIA,MAAMC,KAAN,SAAoBH,SAApB,CAA8B;AAC5BI,EAAAA,WAAW,GAAG;AACZ;AACA,SAAKC,WAAL,GAAmB,KAAKA,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAAnB;AACA,SAAKC,YAAL,GAAoB,KAAKA,YAAL,CAAkBD,IAAlB,CAAuB,IAAvB,CAApB;AACA,SAAKE,cAAL,GAAsB,KAAKA,cAAL,CAAoBF,IAApB,CAAyB,IAAzB,CAAtB;AACA,SAAKG,KAAL,GAAa;AACXC,MAAAA,GAAG,EAAE,EADM;AAEXC,MAAAA,MAAM,EAAE,CAFG;AAGXC,MAAAA,OAAO,EAAE;AAHE,KAAb;AAKD;;AAEDC,EAAAA,iBAAiB,GAAG;AAClB,SAAKR,WAAL;AACD;;AAEDA,EAAAA,WAAW,GAAE;AACX,UAAMS,OAAO,GAAE,KAAKC,KAAL,CAAWC,EAA1B;AACA,UAAMC,KAAK,GAAE,KAAKF,KAAL,CAAWG,SAAxB;AACAC,IAAAA,KAAK,CAAC,aAAD,CAAL,CACCC,IADD,CACMC,GAAG,IAAIA,GAAG,CAACC,IAAJ,EADb,EAECF,IAFD,CAEMG,IAAI,IAAI;AACZ,YAAMC,MAAM,GAAGD,IAAI,CAACE,MAAL,CACb,UAAUC,OAAV,EAAmB;AACjB,eAAOC,QAAQ,CAACD,OAAO,CAACd,OAAT,EAAkB,EAAlB,CAAR,KAAkCE,OAAlC,IAA6CY,OAAO,CAACE,KAAR,KAAkBX,KAAtE;AACD,OAHY,CAAf;AAKA,YAAMY,OAAO,GAAEL,MAAM,CAAC,CAAD,CAArB;AACAM,MAAAA,OAAO,CAACC,GAAR,CAAYP,MAAM,KAAKQ,SAAX,IAAwBR,MAAM,CAACS,MAAP,IAAiB,CAArD;;AACA,UAAG,CAACT,MAAD,KAAYQ,SAAZ,IAAyB,CAACR,MAAM,CAACS,MAAR,IAAkB,CAA9C,EAAgD;AAC9C,aAAKC,QAAL,CAAc;AACZxB,UAAAA,GAAG,EAAEmB,OAAO,CAACnB,GADD;AAEZC,UAAAA,MAAM,EAAEkB,OAAO,CAAClB,MAFJ;AAGZC,UAAAA,OAAO,EAAEiB,OAAO,CAACjB;AAHL,SAAd;AAKD,OAND,MAOI;AACF,aAAKsB,QAAL,CAAc;AACZxB,UAAAA,GAAG,EAAE,EADO;AAEZC,UAAAA,MAAM,EAAE,CAFI;AAGZC,UAAAA,OAAO,EAAE,KAAKG,KAAL,CAAWH;AAHR,SAAd;AAKD;;AACDkB,MAAAA,OAAO,CAACC,GAAR,CAAY,KAAKtB,KAAL,CAAWC,GAAvB;AACD,KAzBD;AA2BD;;AAEDH,EAAAA,YAAY,CAAE4B,SAAF,EAAc;AACxBL,IAAAA,OAAO,CAACC,GAAR,CAAYI,SAAZ;AACA,SAAKD,QAAL,CAAc;AACZvB,MAAAA,MAAM,EAAEwB,SADI;AAEZvB,MAAAA,OAAO,EAAE,KAAKG,KAAL,CAAWC;AAFR,KAAd;AAIAc,IAAAA,OAAO,CAACC,GAAR,CAAY,KAAKtB,KAAL,CAAWC,GAAvB;AACA,SAAKF,cAAL,CAAoB2B,SAApB;AACD;;AAED3B,EAAAA,cAAc,CAAC4B,GAAD,EAAM;AAClBN,IAAAA,OAAO,CAACC,GAAR,CAAYK,GAAZ;AACAN,IAAAA,OAAO,CAACC,GAAR,CAAY,KAAKtB,KAAL,CAAWC,GAAvB;AACA,UAAMI,OAAO,GAAG,KAAKC,KAAL,CAAWC,EAA3B;;AACA,QAAG,KAAKP,KAAL,CAAWC,GAAX,KAAmB,EAAnB,IAAyB,KAAKD,KAAL,CAAWC,GAAX,KAAmBsB,SAA/C,EAA0D;AACxDb,MAAAA,KAAK,CAAC,YAAD,EAAe;AAClBkB,QAAAA,MAAM,EAAE,MADU;AAElBC,QAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AACnBxB,UAAAA,EAAE,EAAE,KAAKP,KAAL,CAAWC,GADI;AAEnBC,UAAAA,MAAM,EAACyB,GAFY;AAGnBxB,UAAAA,OAAO,EAACE;AAHW,SAAf,CAFY;AAOlB2B,QAAAA,OAAO,EAAE;AACP,oBAAU,kBADH;AAEP,0BAAgB;AAFT;AAPS,OAAf,CAAL,CAYGrB,IAZH,CAYQC,GAAG,IAAIA,GAAG,CAACC,IAAJ,EAZf,EAaGF,IAbH,CAaQG,IAAI,IAAI;AACZO,QAAAA,OAAO,CAACC,GAAR,CAAYR,IAAZ;AACA,aAAKlB,WAAL;AACD,OAhBH;AAiBD,KAlBD,MAoBM;AACJc,MAAAA,KAAK,sBAAe,KAAKV,KAAL,CAAWC,GAA1B,GAAiC;AACpC2B,QAAAA,MAAM,EAAE,KAD4B;AAEpCC,QAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AACnBxB,UAAAA,EAAE,EAAE,KAAKP,KAAL,CAAWC,GADI;AAEnBC,UAAAA,MAAM,EAACyB,GAFY;AAGnBxB,UAAAA,OAAO,EAAC,KAAKH,KAAL,CAAWG;AAHA,SAAf,CAF8B;AAOpC6B,QAAAA,OAAO,EAAE;AACP,oBAAU,kBADH;AAEP,0BAAgB;AAFT;AAP2B,OAAjC,CAAL,CAYGrB,IAZH,CAYQC,GAAG,IAAIA,GAAG,CAACC,IAAJ,EAZf,EAaGF,IAbH,CAaQG,IAAI,IAAI;AACZO,QAAAA,OAAO,CAACC,GAAR,CAAYR,IAAZ;AACA,aAAKlB,WAAL;AACD,OAhBH;AAiBD;AAEF;;AAKDqC,EAAAA,MAAM,GAAE;AACJ,WACI;AAAK,MAAA,GAAG,EAAE,KAAK3B,KAAL,CAAWC,EAArB;AAA0B,MAAA,SAAS,EAAC,WAApC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACA;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAK,MAAA,SAAS,EAAC,KAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE;AAAK,MAAA,SAAS,EAAC,mBAAf;AAAmC,MAAA,GAAG,EAAE,KAAKD,KAAL,CAAW4B,OAAnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CADF,EAIE;AAAK,MAAA,SAAS,EAAC,UAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAK,MAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACA;AAAI,MAAA,SAAS,EAAC,YAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAA4B,KAAK5B,KAAL,CAAW6B,KAAvC,CADA,EAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAK,KAAK7B,KAAL,CAAWG,SAAhB,CAFA,EAIA,oBAAC,WAAD;AACA,MAAA,MAAM,EAAE,KAAKT,KAAL,CAAWE,MADnB;AAEA,MAAA,cAAc,EAAC,MAFf;AAGA,MAAA,YAAY,EAAE,KAAKJ,YAHnB;AAIA,MAAA,aAAa,EAAE,CAJf;AAKA,MAAA,IAAI,EAAC,QALL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAJA,EAWA;AAAG,MAAA,SAAS,EAAC,6BAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAA4C,KAAKQ,KAAL,CAAW8B,WAAvD,CAXA,EAYE,KAAK9B,KAAL,CAAW+B,KAAX,KAAqB,MAAtB,GAA+B,oBAAC,IAAD;AAAM,MAAA,SAAS,EAAC,gCAAhB;AAAiD,MAAA,EAAE,kBAAW,KAAK/B,KAAL,CAAWC,EAAtB,CAAnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAA/B,GACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAbD,CADJ,CAJF,CADJ,CADA,CADJ;AA6BH;;AA1I2B;;AA4I9B,eAAeb,KAAf","sourcesContent":["import React, { Component } from 'react';\nimport {Link} from 'react-router-dom';\nimport StarRatings from 'react-star-ratings';\n\n\n\nclass Movie extends Component {\n  constructor() {\n    super();\n    this.fetchRating = this.fetchRating.bind(this);\n    this.changeRating = this.changeRating.bind(this);\n    this.addRatingMovie = this.addRatingMovie.bind(this);\n    this.state = {\n      _id: '', \n      rating: 1,\n      idmovie: ''\n    }\n  };\n\n  componentDidMount() {\n    this.fetchRating();\n  }\n\n  fetchRating(){\n    const IDMOVIE= this.props.id;\n    const EMAIL= this.props.useremail;\n    fetch('/api/movie/')\n    .then(res => res.json())\n    .then(data => {\n      const myRate = data.filter(\n        function (element) {\n          return parseInt(element.idmovie, 10) === IDMOVIE && element.email === EMAIL; \n        }\n      );       \n      const newRate= myRate[0];\n      console.log(myRate === undefined || myRate.length == 0); \n      if(!myRate === undefined || !myRate.length == 0){\n        this.setState({\n          _id: newRate._id ,\n          rating: newRate.rating,\n          idmovie: newRate.idmovie\n        });\n      }\n      else{\n        this.setState({\n          _id: '' ,\n          rating: 0,\n          idmovie: this.props.idmovie\n        });  \n      }\n      console.log(this.state._id);\n    });\n\n  }\n\n  changeRating( newRating ) {\n    console.log(newRating);\n    this.setState({\n      rating: newRating,\n      idmovie: this.props.id\n    });\n    console.log(this.state._id);\n    this.addRatingMovie(newRating);\n  }\n\n  addRatingMovie(rat) {\n    console.log(rat);\n    console.log(this.state._id);\n    const IDMOVIE = this.props.id;\n    if(this.state._id === '' || this.state._id === undefined ){\n      fetch('/api/movie', {\n        method: 'POST',\n        body: JSON.stringify({\n          id: this.state._id,\n          rating:rat,\n          idmovie:IDMOVIE\n        }),\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        }\n      })\n        .then(res => res.json())\n        .then(data => {\n          console.log(data);\n          this.fetchRating();\n        });\n    }\n    \n    else  {\n      fetch(`/api/movie/${this.state._id}`, {\n        method: 'PUT',\n        body: JSON.stringify({\n          id: this.state._id,\n          rating:rat,\n          idmovie:this.state.idmovie\n        }),\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n        }\n      })\n        .then(res => res.json())\n        .then(data => {\n          console.log(data);\n          this.fetchRating();\n        });\n    }\n\n  }\n\n\n  \n\n  render(){\n      return(\n          <div key={this.props.id}  className='col-md-12'>         \n          <div className=\"card p-3\">\n              <div className=\"row\">\n                <div className=\"col-md-4\">\n                  <img className=\"card-img-top mb-2\" src={this.props.picture}/>\n                </div>\n                <div className=\"col-md-8\">\n                    <div className=\"card-body\">\n                    <h4 className=\"card-title\">{this.props.title}</h4> \n                    <h2>{this.props.useremail}</h2> \n                           \n                    <StarRatings \n                    rating={this.state.rating}\n                    starRatedColor=\"gold\"\n                    changeRating={this.changeRating}\n                    numberOfStars={5}\n                    name='rating'\n                  />                      \n                    <p className=\"card-text mt-3 text-justify\">{this.props.description}</p>\n                    {(this.props.place === 'home')? <Link className=\"btn btn-block btn-outline-info\" to={`movie/${this.props.id}`} >ver más</Link>\n                    :<br/>\n                  }\n                    </div>\n                </div>\n            </div>\n          </div> \n        </div> \n      )\n  }\n}\nexport default Movie;\n\n\n\n\n\n "]},"metadata":{},"sourceType":"module"}